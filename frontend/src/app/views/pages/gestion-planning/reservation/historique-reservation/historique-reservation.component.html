<div class="d-flex justify-content-between align-items-center flex-wrap grid-margin mb-1">
    <nav class="page-breadcrumb cursor-pointer">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item active"><a>Historique des Réservations</a></li>
      </ol>
    </nav>

    <div class="d-flex justify-content-end align-items-center gap-2">
      <button type="button" class="btn btn-primary btn-icon-text" (click)="refresh()">
        <i class="feather icon-refresh-ccw me-2"></i> Actualiser
      </button>
    </div>
</div>

<div class="card mt-4">
    <div class="card-body p-0">

      <section class="table-container mat-elevation-z8" tabindex="0">

        <table mat-table [dataSource]="dataSource?.payload">

          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef class="table-head-text">Action</th>
            <td mat-cell *matCellDef="let hist">
              <span [ngClass]="{
                  'text-success': hist.action.includes('valider'),
                  'text-danger': hist.action.includes('rejeter') || hist.action.includes('annuler'),
                  'text-primary': hist.action.includes('demander') || hist.action.includes('modifier')
                }">
                {{ hist.action | titlecase }}
              </span>
            </td>
          </ng-container>

          <ng-container matColumnDef="utilisateur">
            <th mat-header-cell *matHeaderCellDef class="table-head-text">Utilisateur</th>
            <td mat-cell *matCellDef="let hist">
              {{ hist.utilisateur?.nom || 'N/A' }} {{ hist.utilisateur?.prenom || '' }}
            </td>
          </ng-container>

          <ng-container matColumnDef="reservation">
            <th mat-header-cell *matHeaderCellDef class="table-head-text">ID Réservation</th>
            <td mat-cell *matCellDef="let hist">{{ hist.reservation_id }}</td>
          </ng-container>

          <ng-container matColumnDef="date_action">
            <th mat-header-cell *matHeaderCellDef class="table-head-text">Date et Heure</th>
            <td mat-cell *matCellDef="let hist">{{ hist.date_action | date:'dd/MM/yyyy \'à\' HH:mm' }}</td>
          </ng-container>

          <ng-container matColumnDef="details">
            <th mat-header-cell *matHeaderCellDef class="table-head-text">Détails</th>
            <td mat-cell *matCellDef="let hist">{{ hist.details || 'Aucun détail' }}</td>
          </ng-container>
          
          <ng-container matColumnDef="actions" stickyEnd>
            <th mat-header-cell *matHeaderCellDef class="table-head-text">Actions</th>
            <td mat-cell *matCellDef="let hist">
              <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Menu d’actions">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="supprimerHistorique(hist)">
                  <mat-icon class="text-danger">delete</mat-icon>
                  <span class="text-danger">Supprimer</span>
                </button>
              </mat-menu>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="table-head-bg"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>

        <span *ngIf="dataSource?.payload?.length === 0 && !loadingIndicator" class="paginate text-danger mt-4 p-3">
          Aucun historique trouvé pour le moment...
        </span>

        <div class="paginate">
          <ngb-pagination
            [collectionSize]="dataSource?.metadata?.totalElements"
            [page]="pageOptions.page + 1"
            [pageSize]="pageOptions.size"
            [maxSize]="5"
            (pageChange)="paginate($event)"
            size="sm"
            [rotate]="true"
            [ellipses]="true"
            [boundaryLinks]="true">
          </ngb-pagination>
        </div>
      </section>
    </div>
</div>