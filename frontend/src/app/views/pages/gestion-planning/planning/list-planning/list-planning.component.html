<div class="d-flex justify-content-between align-items-center flex-wrap grid-margin mb-1 mt-2">
    <nav class="page-breadcrumb cursor-pointer">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item active"><a>Liste des Plannings</a></li>
        </ol>
    </nav>

    <div class="input-group w-50">
        <!-- L'input est maintenant un formulaire-contrôle standard -->
        <input 
            type="search" 
            class="form-control" 
            placeholder="Rechercher une filiere..."
            (onChange)="openAddPlanning(SearchPlanningModal)">
        
        <!-- L'icône est maintenant attachée comme addon Bootstrap -->
        <span class="input-group-text bg-warning w-20" (search)="doSearch($event)">
            <i class="feather icon-search"></i>
        </span>
    </div>
</div>

<div class="card mt-4">
    <div class="card-body p-0">
        <section class="table-container mat-elevation-z8" tabindex="0">
            <table mat-table [dataSource]="dataSource?.payload || []" multiTemplateDataRows>
        
        <!-- Filière -->
        <ng-container matColumnDef="filiere">
            <th mat-header-cell *matHeaderCellDef class="table-head-text">Filière</th>
            <td mat-cell *matCellDef="let planning">{{  planning?.filiere_nom || '-' }}</td>
        </ng-container>

        <!-- Classe -->
        <ng-container matColumnDef="classe">
            <th mat-header-cell *matHeaderCellDef class="table-head-text">Classe</th>
            <td mat-cell *matCellDef="let planning">{{  planning?.classe_nom || '-' }}</td>
        </ng-container>

        <!-- Planning -->
        <ng-container matColumnDef="planning">
            <th mat-header-cell *matHeaderCellDef class="table-head-text">Planning</th>
            <td mat-cell *matCellDef="let planning" class="px-3">
                <a [routerLink]="['/admin/gestion-planning/planning/details', planning?.id_filiere  , planning?.id_classe ]"
                    class="text-succes">
                    <mat-icon class="text-warning">event</mat-icon>
                </a>
            </td>
        </ng-container>
        <!-- Actions -->
        <ng-container matColumnDef="actions" stickyEnd>
    <th mat-header-cell *matHeaderCellDef class="table-head-text">Actions</th>
    <td mat-cell *matCellDef="let planning">
        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Menu d’actions">
            <mat-icon>more_vert</mat-icon>
        </button>
        
        <mat-menu #menu="matMenu">
            
            <button mat-menu-item (click)="deletePlanning(planning)">
                <mat-icon class="text-danger">delete</mat-icon> 
                <span class="text-danger">Supprimer</span>
            </button>
            
        </mat-menu>
    </td>
</ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="table-head-bg"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>

            <span *ngIf="dataSource?.payload?.length === 0" class="paginate text-danger mt-4">
                Les critères de recherche ne correspondent à aucun planning
            </span>
            
            <div class="paginate">
                <ngb-pagination
                    [collectionSize]="dataSource?.metadata?.totalElements"
                    [page]="pageOptions.page + 1"
                    [pageSize]="pageOptions.size"
                    [maxSize]="5"
                    (pageChange)="paginate($event)"
                    size="sm"
                    [rotate]="true"
                    [ellipses]="true"
                    [boundaryLinks]="true">
                </ngb-pagination>
            </div>
        </section>
    </div>
</div>

<ng-template #SearchPlanningModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Recherche Planning</h5>
        <button type="button" class="btn-close"  (click)="modal.close('by: close icon')" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        <app-add-planning (search)="doSearch($event)" [isSearch]="true" (submit)="close()"></app-add-planning>
    </div>
</ng-template>
