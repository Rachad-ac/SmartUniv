<div class="d-flex justify-content-between align-items-center flex-wrap grid-margin mb-1">
    <nav class="page-breadcrumb cursor-pointer">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item active"><a>Liste des Plannings</a></li>
        </ol>
    </nav>
    <div class="d-flex justify-content-end align-items-center gap-2">
        <button type="button" class="btn btn-secondary btn-icon me-2" (click)="openAddPlanning(SearchPlanningModal)">
            <i class="feather icon-search"></i>
        </button>
        <button type="button" class="btn btn-primary btn-icon-text" (click)="openAddPlanning(addPlanningModal)">
            <i class="feather icon-plus-circle"></i> Nouveau Planning
        </button>
    </div>
</div>

<div class="card mt-4">
    <div class="card-body p-0">
        <section class="table-container mat-elevation-z8" tabindex="0">
            <table mat-table [dataSource]="dataSource?.payload || []" multiTemplateDataRows>
                
        <!-- Classe -->
        <ng-container matColumnDef="classe">
            <th mat-header-cell *matHeaderCellDef class="table-head-text">Classe</th>
            <td mat-cell *matCellDef="let planning">{{  planning.extendedProps?.classe_nom || '-' }}</td>
        </ng-container>
        <!-- Filière -->
        <ng-container matColumnDef="filiere">
            <th mat-header-cell *matHeaderCellDef class="table-head-text">Filière</th>
            <td mat-cell *matCellDef="let planning">{{  planning.extendedProps?.filiere_nom || '-' }}</td>
        </ng-container>
        <!-- Actions -->
        <ng-container matColumnDef="actions" stickyEnd>
    <th mat-header-cell *matHeaderCellDef class="table-head-text">Actions</th>
    <td mat-cell *matCellDef="let planning">
        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Menu d’actions">
            <mat-icon>more_vert</mat-icon>
        </button>
        
        <mat-menu #menu="matMenu">
            
            <a mat-menu-item 
               [routerLink]="['/admin/gestion-planning/planning/details', planning?.id_classe]"
               [queryParams]="{ filiere: planning.classe?.id_filiere }"
               class="text-primary">
                <mat-icon class="text-primary">info</mat-icon>
                <span>Voir planning</span>
            </a>

            <button mat-menu-item (click)="openEditPlanning(EditPlanningModal, planning)">
                <mat-icon class="text-warning">edit</mat-icon> 
                <span class="text-warning">Modifier</span>
            </button>
            
            <button mat-menu-item (click)="deletePlanning(planning)">
                <mat-icon class="text-danger">delete</mat-icon> 
                <span class="text-danger">Supprimer</span>
            </button>
            
        </mat-menu>
    </td>
</ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="table-head-bg"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>

            <span *ngIf="dataSource?.payload?.length === 0" class="paginate text-danger mt-4">
                Les critères de recherche ne correspondent à aucun planning
            </span>
            
            <div class="paginate">
                <ngb-pagination
                    [collectionSize]="dataSource?.metadata?.totalElements"
                    [page]="pageOptions.page + 1"
                    [pageSize]="pageOptions.size"
                    [maxSize]="5"
                    (pageChange)="paginate($event)"
                    size="sm"
                    [rotate]="true"
                    [ellipses]="true"
                    [boundaryLinks]="true">
                </ngb-pagination>
            </div>
        </section>
    </div>
</div>
<ng-template #SearchPlanningModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Recherche Planning</h5>
        <button type="button" class="btn-close"  (click)="modal.close('by: close icon')" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        <app-add-planning (search)="doSearch($event)" [isSearch]="true" (submit)="close()"></app-add-planning>
    </div>
</ng-template>

<ng-template #addPlanningModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title" id="addPlanningModalLabel">Ajouter Planning</h5>
        <button type="button" class="btn-close" (click) = "modal.close('by: close icon')" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        <app-add-planning [isSearch]="false" (submit)="close()"></app-add-planning>
    </div>
</ng-template>

<ng-template #EditPlanningModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title" id="editPlanningModalLabel">Modifier Planning</h5>
        <button type="button" class="btn-close" (click) = "modal.close('by: close icon')" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        <app-edit-planning (submit)="close()" [planningToUpdate]="planningToUpdate"></app-edit-planning>
    </div>
</ng-template>

<ng-template #InfosPlanningModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title" id="infosPlanningModalLabel">Détails Planning</h5>
        <button type="button" class="btn-close" (click) = "modal.close('by: close icon')" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        <app-infos-planning [filters]="{ id_classe: planningToUpdate?.id_classe, id_filiere: planningToUpdate?.id_filiere, id_cours: planningToUpdate?.id_cours }"></app-infos-planning>
    </div>
</ng-template>